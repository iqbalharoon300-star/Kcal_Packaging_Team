{% extends "layout.html" %}
{% block content %}
  <h1>Welcome, {{ current_user.username }}</h1>
  <div class="cards">
    <div class="card stat">
      <div class="stat-title">Total Overtime This Month</div>
      <div class="stat-value">{{ total_ot }}</div>
    </div>
    <div class="card stat">
      <div class="stat-title">Pending Approvals</div>
      <div class="stat-value">{{ pending }}</div>
    </div>
    <div class="card stat">
      <div class="stat-title">Total Employees</div>
      <div class="stat-value">{{ total_employees }}</div>
    </div>
  </div>

  <div class="card">
    <h3>Recent Overtime Records</h3>
    <table class="records">
      <thead><tr><th>Date</th><th>Employee</th><th>Code</th><th>Dept</th><th>Section</th><th>IN</th><th>OUT</th><th>Total</th><th>OT</th>{% if current_user.role in ['manager','supervisor'] %}<th>Actions</th>{% endif %}</tr></thead>
      <tbody>
        {% for r in recent_records %}
        <tr>
          <td>{{ r.date.strftime("%d %b %Y") }}</td>
          <td>{{ r.employee_name }}</td>
          <td>{{ r.employee_code }}</td>
          <td>{{ r.department }}</td>
          <td>{{ r.section }}</td>
          <td>{{ r.duty_in }}</td>
          <td>{{ r.duty_out }}</td>
          <td>{{ "%.2f"|format(r.total_hours) }}</td>
          <td>{{ "%.2f"|format(r.overtime_hours) }}</td>
          {% if current_user.role in ['manager','supervisor'] %}
          <td><a class="btn small" href="{{ url_for('edit_record', rec_id=r.id) }}">Edit</a>
              <form method="POST" action="{{ url_for('delete_record', rec_id=r.id) }}" style="display:inline" onsubmit="return confirm('Delete this record?')">
                <button class="btn small danger" type="submit">Delete</button>
              </form></td>
          {% endif %}
        </tr>
        {% else %}
        <tr><td colspan="10">No records yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
